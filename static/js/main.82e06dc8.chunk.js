(this["webpackJsonpnotion-timeline-widget"]=this["webpackJsonpnotion-timeline-widget"]||[]).push([[0],{19:function(e,t,n){},21:function(e,t,n){"use strict";n.r(t);var o=n(0),a=n.n(o),r=n(7),c=n.n(r),i=n(5),s=n(3),p=n(8),l=n.n(p),u=n(9),d=n.n(u),m=(n(19),n(1)),h=864e5,b=86399999,f={default:"#505558",gray:"#6b6f71",brown:"#695c55",orange:"#917448",yellow:"#9f904d",green:"#487871",blue:"#497088",purple:"#6d5a90",pink:"#924d75",red:"#a05d59"};function g(e){return(e.properties.Scope.multi_select||e.properties.Scope.select)&&e.properties.Event.title&&e.properties.Event.title[0]&&e.properties.Event.title[0].text&&e.properties.Date.date&&(!e.properties.Ongoing||e.properties.Ongoing.checkbox)}function j(){var e=Object(o.useState)([]),t=Object(s.a)(e,2),n=t[0],a=t[1],r=Object(o.useState)(!1),c=Object(s.a)(r,2),p=c[0],u=c[1],j=new URLSearchParams(window.location.search),w=j.get("database_id")||"",O=j.get("token")||"";Object(o.useEffect)((function(){w&&O&&fetch("".concat("https://vr-cors-everywhere.herokuapp.com","/https://api.notion.com/v1/databases/").concat(w,"/query"),{method:"POST",headers:{Authorization:"Bearer ".concat(O),"Notion-Version":"2021-08-16"}}).then((function(e){return e.json()})).then((function(e){e.results&&e.results.some(g)?a(e.results):u(!0)}))}),[w,O]);var v=Object(o.useMemo)((function(){return n.map((function(e){if(!g(e))return console.log("Invalid database item:",JSON.stringify(e,null,2)),[];var t=e.properties.Scope.multi_select?e.properties.Scope.multi_select.map((function(e){return{name:e.name,color:e.color}})):[{name:e.properties.Scope.select.name,color:e.properties.Scope.select.color}];return t.map((function(n){var o,a;return{scope:n,scopes:t,name:e.properties.Event.title[0].text.content,startDate:e.properties.Date.date.start,endDate:e.properties.Date.date.end,ongoing:null!==(o=null===(a=e.properties.Ongoing)||void 0===a?void 0:a.checkbox)&&void 0!==o&&o}}))})).flat()}),[n]),x=Object(o.useMemo)((function(){return Object(i.a)(new Set(v.map((function(e){return{name:e.scope.name,color:e.scope.color}}))))}),[v]),y=Object(o.useMemo)((function(){return v.map((function(e){return{name:"".concat(e.name," (").concat(e.scopes.map((function(e){return e.name})).join(", "),")"),data:[{x:e.scope.name,y:[Date.parse(e.startDate),e.ongoing?Date.now()+b:e.endDate?Date.parse(e.endDate)+b:Date.parse(e.startDate)+b]}]}}))}),[v]),D=Object(o.useMemo)((function(){return[Math.min.apply(Math,Object(i.a)(y.map((function(e){return e.data[0].y[0]}))))||Date.now()-h,Math.max.apply(Math,Object(i.a)(y.map((function(e){return e.data[0].y[1]}))))||Date.now()+h]}),[y]),S=Object(s.a)(D,2),k=S[0],M=S[1],E=(M-k)/100;return w&&O?p?Object(m.jsx)("div",{children:"The database is not supported by this widget"}):Object(m.jsx)(m.Fragment,{children:Object(m.jsx)(l.a,{className:"chart",type:"rangeBar",width:"100%",height:"100%",options:{chart:{toolbar:{offsetX:"-100%",tools:{download:!1,selection:!0,zoom:!0,zoomin:!0,zoomout:!0,pan:!0,customIcons:[{icon:'<img src="'.concat("/notion-timeline-widget",'/reload.svg" width="16">'),class:"custom-icon",index:0,title:"Reload",click:function(){return window.location.reload()}},{icon:'<img src="'.concat("/notion-timeline-widget",'/copy.svg" width="16">'),class:"custom-icon",index:0,title:"Copy URL",click:function(){return d()(window.location.href)}}]}}},plotOptions:{bar:{horizontal:!0}},dataLabels:{enabled:!0,formatter:function(e,t){var n=Object(s.a)(e,2),o=n[0],a=n[1],r=Math.ceil((a-o)/h),c=r+(r>1?" days":" day"),i=y[t.seriesIndex];return i?"".concat(i.name,": ").concat(c):c}},colors:x.map((function(e){return f[e.color]})),theme:{palette:"palette1",mode:"dark"},xaxis:{type:"datetime",min:k-E,max:M+E},legend:{show:!1},stroke:{width:5}},series:y})}):Object(m.jsx)("div",{children:"Database ID and/or Notion token is not provided"})}c.a.render(Object(m.jsx)(a.a.StrictMode,{children:Object(m.jsx)(j,{})}),document.getElementById("root"))}},[[21,1,2]]]);
//# sourceMappingURL=main.82e06dc8.chunk.js.map