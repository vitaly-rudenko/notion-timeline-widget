{"version":3,"sources":["App.js","index.js"],"names":["DAY_MS","ALMOST_DAY_MS","notionColorsDark","default","gray","brown","orange","yellow","green","blue","purple","pink","red","isDatabaseItemValid","item","properties","multi_select","select","title","text","date","checkbox","App","useState","entries","setEntries","isFailed","setIsFailed","searchParams","URLSearchParams","window","location","search","databaseId","get","process","token","width","height","setSize","useEffect","update","innerWidth","innerHeight","addEventListener","removeEventListener","fetch","method","headers","then","response","json","database","results","some","events","useMemo","map","console","log","JSON","stringify","name","content","scopes","s","color","scope","startDate","start","endDate","end","ongoing","group","flat","groupedEvents","Map","event","has","set","filter","e","chartSeries","data","fillColor","strokeColor","Color","lightenByRatio","toCSS","x","y","Date","parse","now","Math","min","max","offset","className","type","options","chart","toolbar","tools","download","selection","zoom","zoomin","zoomout","pan","customIcons","icon","class","index","click","reload","copyToClipboard","href","plotOptions","bar","horizontal","dataLabels","enabled","formatter","_","seriesIndex","dataPointIndex","days","ceil","duration","theme","palette","mode","xaxis","legend","show","stroke","tooltip","custom","grid","borderColor","lines","yaxis","series","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"6RAMMA,EAAS,MACTC,EAAgBD,SAEhBE,EAAmB,CACvBC,QAAS,UACTC,KAAM,UACNC,MAAO,UACPC,OAAQ,UACRC,OAAQ,UACRC,MAAO,UACPC,KAAM,UACNC,OAAQ,UACRC,KAAM,UACNC,IAAK,WAGP,SAASC,EAAoBC,GAC3B,OACGA,EAAKC,WAAL,MAAyBC,cAAgBF,EAAKC,WAAL,MAAyBE,SACnEH,EAAKC,WAAL,MAAyBG,OAASJ,EAAKC,WAAL,MAAyBG,MAAM,IAAMJ,EAAKC,WAAL,MAAyBG,MAAM,GAAGC,MACzGL,EAAKC,WAAL,KAAwBK,QACtBN,EAAKC,WAAL,SAA8BD,EAAKC,WAAL,QAA2BM,aACzDP,EAAKC,WAAL,OAA4BD,EAAKC,WAAL,MAAyBE,QAIpD,SAASK,IACd,MAA8BC,mBAAS,IAAvC,mBAAOC,EAAP,KAAgBC,EAAhB,KACA,EAAgCF,oBAAS,GAAzC,mBAAOG,EAAP,KAAiBC,EAAjB,KAEMC,EAAe,IAAIC,gBAAgBC,OAAOC,SAASC,QACnDC,EAAaL,EAAaM,IAAI,gBAAkBC,GAChDC,EAAQR,EAAaM,IAAI,UAAYC,GAE3C,EAAmCZ,mBAAS,CAAC,IAAK,MAAlD,yCAAQc,EAAR,KAAeC,EAAf,KAAwBC,EAAxB,KAEAC,qBAAU,WACR,IAAMC,EAAS,WACbF,EAAQ,CAACT,OAAOY,WAAYZ,OAAOa,eAKrC,OAFAF,IACAX,OAAOc,iBAAiB,SAAUH,GAC3B,kBAAMX,OAAOe,oBAAoB,SAAUJ,MACjD,IAEHD,qBAAU,WACHP,GAAeG,GAEpBU,MAAM,GAAD,OACAX,2CADA,gDACiFF,EADjF,UAEH,CACEc,OAAQ,OACRC,QAAS,CACP,cAAgB,UAAhB,OAA2BZ,GAC3B,iBAAkB,gBAIrBa,MAAK,SAAAC,GAAQ,OAAIA,EAASC,UAC1BF,MAAK,SAACG,GACAA,EAASC,SAAYD,EAASC,QAAQC,KAAKzC,GAKhDY,EAAW2B,EAASC,SAJlB1B,GAAY,QAMjB,CAACM,EAAYG,IAEhB,IAAMmB,EAASC,mBAAQ,kBAAMhC,EAAQiC,KAAI,SAAA3C,GACvC,IAAKD,EAAoBC,GAEvB,OADA4C,QAAQC,IAAI,yBAA0BC,KAAKC,UAAU/C,EAAM,KAAM,IAC1D,GAGT,IAAMgD,EAAOhD,EAAKC,WAAL,MAAyBG,MAAM,GAAGC,KAAK4C,QAC9CC,EAASlD,EAAKC,WAAL,MAAyBC,aACpCF,EAAKC,WAAL,MAAyBC,aAAayC,KAAI,SAAAQ,GAAC,MAAK,CAChDH,KAAMG,EAAEH,KACRI,MAAOD,EAAEC,UAET,CAAC,CACDJ,KAAMhD,EAAKC,WAAL,MAAyBE,OAAO6C,KACtCI,MAAOpD,EAAKC,WAAL,MAAyBE,OAAOiD,QAG3C,OAAOF,EAAOP,KAAI,SAAAU,GAAK,sBAAK,CAC1BA,QACAH,SACAF,OACAM,UAAWtD,EAAKC,WAAL,KAAwBK,KAAKiD,MACxCC,QAASxD,EAAKC,WAAL,KAAwBK,KAAKmD,IACtCC,QAAO,oBAAE1D,EAAKC,WAAL,eAAF,aAAE,EAA4BM,gBAA9B,SACPoD,MAAO,CACLX,KAAI,oBAAEhD,EAAKC,WAAL,aAAF,aAAE,EAA0BE,OAAO6C,YAAnC,QAA2CK,EAAML,KACrDI,MAAK,oBAAEpD,EAAKC,WAAL,aAAF,aAAE,EAA0BE,OAAOiD,aAAnC,QAA4CC,EAAMD,cAG1DQ,SAAQ,CAAClD,IAENmD,EAAgBnB,mBAAQ,WAC5B,IADkC,EAC5BC,EAAM,IAAImB,IADkB,cAGdrB,GAHc,yBAGvBsB,EAHuB,QAIhC,GAAIpB,EAAIqB,IAAID,EAAMJ,MAAMX,MACtB,iBAGFL,EAAIsB,IAAIF,EAAMJ,MAAMX,KAAMP,EAAOyB,QAAO,SAAAC,GAAC,OAAIA,EAAER,MAAMX,OAASe,EAAMJ,MAAMX,UAL5E,2BAA4B,IAHM,8BAWlC,OAAOL,IACN,CAACF,IAEE2B,EAAc1B,mBAAQ,kBAAM,YAAImB,EAAcnD,WAAWiC,KAAI,YAAqB,IAAD,mBAAlBK,EAAkB,KAAZP,EAAY,KACrF,MAAO,CACLA,SACAO,OACAqB,KAAM5B,EAAOE,KAAI,SAAAoB,GAAK,MAAK,CACzBA,QACAO,UAAWlF,EAAiB2E,EAAMJ,MAAMP,OACxCmB,YAAaC,IAAMpF,EAAiB2E,EAAMJ,MAAMP,QAAQqB,eAAe,IAAKC,QAC5EC,EAAGZ,EAAMV,MAAML,KACf4B,EAAG,CACDC,KAAKC,MAAMf,EAAMT,WACjBS,EAAML,QACDmB,KAAKE,MAAQ5F,EACd4E,EAAMP,QACHqB,KAAKC,MAAMf,EAAMP,SAAWrE,EAC5B0F,KAAKC,MAAMf,EAAMT,WAAanE,aAIzC,CAAC0E,IAEL,EAAmBnB,mBAAQ,iBAAM,CAC/BsC,KAAKC,IAAL,MAAAD,KAAI,YAAQZ,EAAYzB,KAAI,SAAAQ,GAAC,OAAIA,EAAEkB,KAAK,GAAGO,EAAE,SAAQC,KAAKE,MAC1DC,KAAKE,IAAL,MAAAF,KAAI,YAAQZ,EAAYzB,KAAI,SAAAQ,GAAC,OAAIA,EAAEkB,KAAK,GAAGO,EAAE,SAAQC,KAAKE,SACzD,CAACX,IAHJ,mBAAOa,EAAP,KAAYC,EAAZ,KAKMC,EAASH,KAAKE,KAAKA,EAAMD,GAAO,IAAc,EAAT/F,GAE3C,OAAKiC,GAAeG,EAIhBV,EACK,+EAGF,mCACL,cAAC,IAAD,CACEwE,UAAU,QACVC,KAAK,WACL9D,MAAOA,EAAQ,GACfC,OAAQA,EAAS,GACjB8D,QAAS,CACPC,MAAO,CACLC,QAAS,CACPC,MAAO,CACLC,UAAU,EACVC,WAAW,EACXC,MAAM,EACNC,QAAQ,EACRC,SAAS,EACTC,KAAK,EACLC,YAAa,CAAC,CACZC,KAAK,aAAD,OAAe5E,0BAAf,4BACJ6E,MAAO,cACPC,MAAO,EACP/F,MAAO,SACPgG,MAAO,kBAAMpF,OAAOC,SAASoF,WAC5B,CACDJ,KAAK,aAAD,OAAe5E,0BAAf,0BACJ6E,MAAO,cACPC,MAAO,EACP/F,MAAO,WACPgG,MAAO,kBAAME,IAAgBtF,OAAOC,SAASsF,YAKrDC,YAAa,CACXC,IAAK,CACHC,YAAY,IAGhBC,WAAY,CACVC,SAAS,EACTC,UAAW,SAACC,EAAD,GAAyC,IAAnCC,EAAkC,EAAlCA,YAAaC,EAAqB,EAArBA,eACtBjD,EAAQK,EAAY2C,GAAa1C,KAAK2C,GAAgBjD,MAE5D,EAA6BK,EAAY2C,GAAa1C,KAAK2C,GAAgBpC,GAAK,GAAhF,mBAAOtB,EAAP,KAAkBE,EAAlB,KACMyD,EAAOjC,KAAKkC,MAAM1D,EAAUF,GAAapE,GACzCiI,EAAW,KAAOF,GAAQA,EAAO,EAAI,QAAU,QAAU,IAE/D,OAAOlD,EAAMf,MAAQe,EAAMP,QAAU2D,EAAW,MAGpDC,MAAO,CACLC,QAAS,WACTC,KAAM,QAERC,MAAO,CACLlC,KAAM,WACNJ,IAAKA,EAAME,EACXD,IAAKA,EAAMC,GAEbqC,OAAQ,CACNC,MAAM,GAERC,OAAQ,CACNnG,MAAO,GAEToG,QAAS,CACPC,OAAQ,YAAsC,IAAnCb,EAAkC,EAAlCA,YAAaC,EAAqB,EAArBA,eAChBjD,EAAQK,EAAY2C,GAAa1C,KAAK2C,GAAgBjD,MAE5D,EAA6BK,EAAY2C,GAAa1C,KAAK2C,GAAgBpC,GAAK,GAAhF,mBAAOtB,EAAP,KAAkBE,EAAlB,KACMyD,EAAOjC,KAAKkC,MAAM1D,EAAUF,GAAapE,GACzCiI,EAAW,KAAOF,GAAQA,EAAO,EAAI,QAAU,QAAU,IAE/D,MAAM,sFAAN,OAC2ClD,EAAMf,MADjD,OACwDe,EAAMP,QAAU2D,EAAW,GADnF,wEAE6CpD,EAAMT,WAFnD,OAE+DS,EAAMP,QAAN,aAAsBO,EAAMP,SAAY,GAFvG,8BAMJqE,KAAM,CACJJ,MAAM,EACNK,YAAa,YACbP,MAAO,CACLQ,MAAO,CACLN,MAAM,IAGVO,MAAO,CACLD,MAAO,CACLN,MAAM,MAKdQ,OAAQ7D,MApGH,kFClJX8D,IAASC,OACP,cAAC,IAAMC,WAAP,UACE,cAAC,EAAD,MAEFC,SAASC,eAAe,W","file":"static/js/main.97a3971e.chunk.js","sourcesContent":["import React, { useEffect, useState, useMemo } from 'react'\nimport ApexChart from 'react-apexcharts'\nimport copyToClipboard from 'copy-to-clipboard'\nimport Color from 'color-js'\nimport './App.css'\n\nconst DAY_MS = 24 * 60 * 60 * 1000\nconst ALMOST_DAY_MS = DAY_MS - 1\n\nconst notionColorsDark = {\n  default: '#505558',\n  gray: '#6b6f71',\n  brown: '#695c55',\n  orange: '#917448',\n  yellow: '#9f904d',\n  green: '#487871',\n  blue: '#497088',\n  purple: '#6d5a90',\n  pink: '#924d75',\n  red: '#a05d59',\n}\n\nfunction isDatabaseItemValid(item) {\n  return (\n    (item.properties['Scope'].multi_select || item.properties['Scope'].select) &&\n    item.properties['Event'].title && item.properties['Event'].title[0] && item.properties['Event'].title[0].text &&\n    item.properties['Date'].date &&\n    (!item.properties['Ongoing'] || item.properties['Ongoing'].checkbox) &&\n    (!item.properties['Group'] || item.properties['Group'].select)\n  )\n}\n\nexport function App() {\n  const [entries, setEntries] = useState([])\n  const [isFailed, setIsFailed] = useState(false)\n\n  const searchParams = new URLSearchParams(window.location.search)\n  const databaseId = searchParams.get('database_id') || process.env.REACT_APP_TEST_DATABASE_ID\n  const token = searchParams.get('token') || process.env.REACT_APP_TEST_NOTION_INTEGRATION_TOKEN\n\n  const [[width, height], setSize] = useState([800, 300])\n\n  useEffect(() => {\n    const update = () => {\n      setSize([window.innerWidth, window.innerHeight])\n    }\n    \n    update()\n    window.addEventListener('resize', update)\n    return () => window.removeEventListener('resize', update)\n  }, [])\n  \n  useEffect(() => {\n    if (!databaseId || !token) return\n\n    fetch(\n      `${process.env.REACT_APP_CORS_EVERYWHERE_URL}/https://api.notion.com/v1/databases/${databaseId}/query`,\n      {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${token}`,\n          'Notion-Version': '2021-08-16',\n        }\n      }\n    )\n      .then(response => response.json())\n      .then((database) => {\n        if (!database.results || !database.results.some(isDatabaseItemValid)) {\n          setIsFailed(true)\n          return\n        }\n\n        setEntries(database.results)\n      })\n  }, [databaseId, token])\n\n  const events = useMemo(() => entries.map(item => {\n    if (!isDatabaseItemValid(item)) {\n      console.log('Invalid database item:', JSON.stringify(item, null, 2))\n      return []\n    }\n\n    const name = item.properties['Event'].title[0].text.content\n    const scopes = item.properties['Scope'].multi_select\n      ? item.properties['Scope'].multi_select.map(s => ({\n        name: s.name,\n        color: s.color,\n      }))\n      : [{\n        name: item.properties['Scope'].select.name,\n        color: item.properties['Scope'].select.color,\n      }]\n\n    return scopes.map(scope => ({\n      scope,\n      scopes,\n      name,\n      startDate: item.properties['Date'].date.start,\n      endDate: item.properties['Date'].date.end,\n      ongoing: item.properties['Ongoing']?.checkbox ?? false,\n      group: {\n        name: item.properties['Group']?.select.name ?? scope.name,\n        color: item.properties['Group']?.select.color ?? scope.color,\n      }\n    }))\n  }).flat(), [entries])\n\n  const groupedEvents = useMemo(() => {\n    const map = new Map()\n\n    for (const event of events) {\n      if (map.has(event.group.name)) {\n        continue\n      }\n\n      map.set(event.group.name, events.filter(e => e.group.name === event.group.name))\n    }\n\n    return map\n  }, [events])\n\n  const chartSeries = useMemo(() => [...groupedEvents.entries()].map(([name, events]) => {\n    return {\n      events,\n      name,\n      data: events.map(event => ({\n        event,\n        fillColor: notionColorsDark[event.group.color],\n        strokeColor: Color(notionColorsDark[event.group.color]).lightenByRatio(0.5).toCSS(),\n        x: event.scope.name,\n        y: [\n          Date.parse(event.startDate),\n          event.ongoing\n            ? (Date.now() + ALMOST_DAY_MS)\n            : event.endDate\n              ? (Date.parse(event.endDate) + ALMOST_DAY_MS)\n              : (Date.parse(event.startDate) + ALMOST_DAY_MS),\n        ]\n      }))\n    }\n  }), [groupedEvents])\n\n  const [min, max] = useMemo(() => [\n    Math.min(...chartSeries.map(s => s.data[0].y[0])) || Date.now(),\n    Math.max(...chartSeries.map(s => s.data[0].y[1])) || Date.now(),\n  ], [chartSeries])\n\n  const offset = Math.max((max - min) / 100, DAY_MS * 7)\n\n  if (!databaseId || !token) {\n    return <div>Database ID and/or Notion token is not provided</div>\n  }\n\n  if (isFailed) {\n    return <div>The database is not supported by this widget</div>\n  }\n\n  return <>\n    <ApexChart\n      className=\"chart\"\n      type=\"rangeBar\"\n      width={width - 20}\n      height={height - 20}\n      options={{\n        chart: {\n          toolbar: {\n            tools: {\n              download: false,\n              selection: true,\n              zoom: true,\n              zoomin: true,\n              zoomout: true,\n              pan: true,\n              customIcons: [{\n                icon: `<img src=\"${process.env.PUBLIC_URL}/reload.svg\" width=\"16\">`,\n                class: 'custom-icon',\n                index: 0,\n                title: 'Reload',\n                click: () => window.location.reload()\n              }, {\n                icon: `<img src=\"${process.env.PUBLIC_URL}/copy.svg\" width=\"16\">`,\n                class: 'custom-icon',\n                index: 0,\n                title: 'Copy URL',\n                click: () => copyToClipboard(window.location.href),\n              }]\n            }\n          }\n        },\n        plotOptions: {\n          bar: {\n            horizontal: true,\n          },\n        },\n        dataLabels: {\n          enabled: true,\n          formatter: (_, { seriesIndex, dataPointIndex }) => {\n            const event = chartSeries[seriesIndex].data[dataPointIndex].event\n\n            const [startDate, endDate] = chartSeries[seriesIndex].data[dataPointIndex].y || []\n            const days = Math.ceil((endDate - startDate) / DAY_MS)\n            const duration = ' (' + days + (days > 1 ? \" days\" : \" day\") + ')'\n\n            return event.name + (event.endDate ? duration : '')\n          },\n        },\n        theme: {\n          palette: 'palette1',\n          mode: 'dark',\n        },\n        xaxis: {\n          type: \"datetime\",\n          min: min - offset,\n          max: max + offset,\n        },\n        legend: {\n          show: true,\n        },\n        stroke: {\n          width: 2,\n        },\n        tooltip: {\n          custom: ({ seriesIndex, dataPointIndex }) => {\n            const event = chartSeries[seriesIndex].data[dataPointIndex].event\n\n            const [startDate, endDate] = chartSeries[seriesIndex].data[dataPointIndex].y || []\n            const days = Math.ceil((endDate - startDate) / DAY_MS)\n            const duration = ' (' + days + (days > 1 ? \" days\" : \" day\") + ')'\n\n            return `<div class=\"chart__tooltip\">\n              <p class=\"chart__tooltip-primary-text\">${event.name}${event.endDate ? duration : ''}</p>\n              <p class=\"chart__tooltip-secondary-text\">${event.startDate}${event.endDate ? ` - ${event.endDate}` : ''}</p>\n            </div>`\n          }\n        },\n        grid: {\n          show: true,\n          borderColor: '#FFFFFF22',\n          xaxis: {\n            lines: {\n              show: true\n            }\n          },\n          yaxis: {\n            lines: {\n              show: true\n            }\n          },\n        }\n      }}\n      series={chartSeries}\n    />\n  </>;\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { App } from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}