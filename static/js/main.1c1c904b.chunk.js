(this["webpackJsonpnotion-timeline-widget"]=this["webpackJsonpnotion-timeline-widget"]||[]).push([[0],{21:function(e,t,n){},23:function(e,t,n){"use strict";n.r(t);var o=n(1),a=n.n(o),r=n(9),i=n.n(r),c=n(10),s=n(5),l=n(2),d=n(11),p=n.n(d),u=n(7),m=n.n(u),b=n(8),h=n.n(b),j=(n(21),n(0)),f=864e5,v=86399999,g={default:"#505558",gray:"#6b6f71",brown:"#695c55",orange:"#917448",yellow:"#9f904d",green:"#487871",blue:"#497088",purple:"#6d5a90",pink:"#924d75",red:"#a05d59"};function O(e){return(e.properties.Scope.multi_select||e.properties.Scope.select)&&e.properties.Event.title&&e.properties.Event.title[0]&&e.properties.Event.title[0].text&&e.properties.Date.date&&(!e.properties.Ongoing||e.properties.Ongoing.checkbox)&&(!e.properties.Group||e.properties.Group.select)}function w(){var e=Object(o.useState)([]),t=Object(l.a)(e,2),n=t[0],a=t[1],r=Object(o.useState)(!1),i=Object(l.a)(r,2),d=i[0],u=i[1],b=Object(o.useState)(""),w=Object(l.a)(b,2),x=w[0],y=w[1],D=Object(o.useState)(!0),S=Object(l.a)(D,2),k=S[0],N=S[1],C=new URLSearchParams(window.location.search),_=C.get("database_id")||"",M=C.get("token")||"",B=Object(o.useState)([800,300]),z=Object(l.a)(B,2),E=Object(l.a)(z[0],2),F=E[0],I=E[1],R=z[1];Object(o.useEffect)((function(){var e=function(){R([window.innerWidth,window.innerHeight])};return e(),window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]),Object(o.useEffect)((function(){_&&M&&(N(!0),fetch("".concat("https://vr-cors-everywhere.herokuapp.com","/https://api.notion.com/v1/databases/").concat(_,"/query"),{method:"POST",headers:{Authorization:"Bearer ".concat(M),"Notion-Version":"2021-08-16"}}).then((function(e){return e.json()})).then((function(e){e.results&&e.results.some(O)?a(e.results):u(!0)})).finally((function(){return N(!1)})))}),[_,M]);var L=Object(o.useMemo)((function(){return n.map((function(e){if(!O(e))return console.log("Invalid database item:",JSON.stringify(e,null,2)),[];var t=e.properties.Event.title[0].text.content,n=e.properties.Scope.multi_select?e.properties.Scope.multi_select.map((function(e){return{name:e.name,color:e.color}})):[{name:e.properties.Scope.select.name,color:e.properties.Scope.select.color}];return n.map((function(o){var a,r,i,c,s,l;return{scope:o,scopes:n,name:t,startDate:e.properties.Date.date.start,endDate:e.properties.Date.date.end,ongoing:null!==(a=null===(r=e.properties.Ongoing)||void 0===r?void 0:r.checkbox)&&void 0!==a&&a,group:{name:null!==(i=null===(c=e.properties.Group)||void 0===c?void 0:c.select.name)&&void 0!==i?i:o.name,color:null!==(s=null===(l=e.properties.Group)||void 0===l?void 0:l.select.color)&&void 0!==s?s:o.color}}}))})).flat()}),[n]),G=Object(o.useMemo)((function(){var e,t=new Map,n=Object(s.a)(new Set(L.map((function(e){return e.group.name})))),o=Object(c.a)(n);try{var a=function(){var n=e.value,o=L.filter((function(e){return e.group.name===n}));t.set(o[0].group,o)};for(o.s();!(e=o.n()).done;)a()}catch(r){o.e(r)}finally{o.f()}return t}),[L]),K=Object(o.useMemo)((function(){return Object(s.a)(G.entries()).map((function(e){var t=Object(l.a)(e,2),n=t[0],o=t[1];return{events:o,name:n.name,color:h()(g[n.color]).lightenByRatio(.5).saturateByRatio(2).toCSS(),data:o.map((function(e){return{event:e,fillColor:g[e.group.color],strokeColor:h()(g[e.group.color]).lightenByRatio(.5).toCSS(),x:e.scope.name,y:[Date.parse(e.startDate),e.ongoing?Date.now()+v:e.endDate?Date.parse(e.endDate)+v:Date.parse(e.startDate)+v]}}))}}))}),[G]),Y=Object(o.useMemo)((function(){return[Math.min.apply(Math,Object(s.a)(K.map((function(e){return e.data[0].y[0]}))))||Date.now(),Math.max.apply(Math,Object(s.a)(K.map((function(e){return e.data[0].y[1]}))))||Date.now()]}),[K]),A=Object(l.a)(Y,2),J=A[0],U=A[1],P=Math.max((U-J)/100,7*f);return _&&M?d?Object(j.jsx)("div",{className:"page",children:Object(j.jsx)("div",{className:"title",children:"The database is not supported by this widget"})}):k?Object(j.jsx)("div",{className:"page",children:Object(j.jsx)("div",{className:"title",children:"Loading..."})}):Object(j.jsx)(j.Fragment,{children:Object(j.jsx)(p.a,{className:"chart",type:"rangeBar",width:F-40,height:I-40,options:{chart:{toolbar:{tools:{download:!1,selection:!0,zoom:!0,zoomin:!0,zoomout:!0,pan:!0,customIcons:[{icon:'<img src="'.concat("/notion-timeline-widget",'/reload.svg" width="16">'),class:"custom-icon",index:0,title:"Reload",click:function(){return window.location.reload()}},{icon:'<img src="'.concat("/notion-timeline-widget",'/copy.svg" width="16">'),class:"custom-icon",index:0,title:"Copy URL",click:function(){return m()(window.location.href)}}]}}},plotOptions:{bar:{horizontal:!0}},dataLabels:{enabled:!0,formatter:function(e,t){var n=t.seriesIndex,o=t.dataPointIndex,a=K[n].data[o].event,r=K[n].data[o].y||[],i=Object(l.a)(r,2),c=i[0],s=i[1],d=Math.ceil((s-c)/f),p=" ("+d+(d>1?" days":" day")+")";return a.name+(a.endDate?p:"")}},theme:{palette:"palette1",mode:"dark"},xaxis:{type:"datetime",min:J-P,max:U+P},legend:{show:!0,labels:{useSeriesColors:!0}},stroke:{width:2},tooltip:{custom:function(e){var t=e.seriesIndex,n=e.dataPointIndex,o=K[t].data[n].event,a=K[t].data[n].y||[],r=Object(l.a)(a,2),i=r[0],c=r[1],s=Math.ceil((c-i)/f),d=" ("+s+(s>1?" days":" day")+")";return'<div class="chart__tooltip">\n              <p class="chart__tooltip-primary-text">'.concat(o.group.name,": ").concat(o.name).concat(o.endDate?d:"",'</p>\n              <p class="chart__tooltip-secondary-text">').concat(o.startDate).concat(o.endDate?" - ".concat(o.endDate):"","</p>\n            </div>")}},grid:{show:!0,borderColor:"#FFFFFF22",xaxis:{lines:{show:!0}},yaxis:{lines:{show:!0}}}},series:K})}):Object(j.jsxs)("div",{className:"page",onSubmit:function(e){e.preventDefault();var t=e.target.databaseUrl.value.split("/").pop().split("?")[0],n=e.target.notionIntegrationToken.value,o="https://vitaly-rudenko.github.io/notion-timeline-widget/?database_id=".concat(t,"&token=").concat(n);y(o),m()(o)},children:[Object(j.jsxs)("form",{className:"form",children:[Object(j.jsxs)("div",{className:"form-group",children:[Object(j.jsx)("label",{children:"Database URL"}),Object(j.jsx)("input",{type:"text",name:"databaseUrl",placeholder:"https://www.notion.so/my-user/1790d3b3f05546f69989f10869398c19"})]}),Object(j.jsxs)("div",{className:"form-group",children:[Object(j.jsx)("label",{children:"Notion integration token"}),Object(j.jsx)("input",{type:"text",name:"notionIntegrationToken",placeholder:"secret_DBaA6SzYK9bBcD5H7vCKS5mvJukYVsKG4CYfAcFCoRX",defaultValue:M})]}),Object(j.jsx)("div",{className:"buttons",children:Object(j.jsx)("button",{type:"submit",className:"button",children:"Create widget"})})]}),Object(j.jsx)("input",{type:"text",className:"result",value:x,placeholder:"https://vitaly-rudenko.github.io/notion-timeline-widget/?database_id=1790d3b3f05546f69989f10869398c19&token=secret_DBaA6SzYK9bBcD5H7vCKS5mvJukYVsKG4CYfAcFCoRX"})]})}i.a.render(Object(j.jsx)(a.a.StrictMode,{children:Object(j.jsx)(w,{})}),document.getElementById("root"))}},[[23,1,2]]]);
//# sourceMappingURL=main.1c1c904b.chunk.js.map