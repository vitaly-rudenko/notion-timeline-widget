(this["webpackJsonpnotion-timeline-widget"]=this["webpackJsonpnotion-timeline-widget"]||[]).push([[0],{21:function(e,t,o){},23:function(e,t,o){"use strict";o.r(t);var n=o(0),a=o.n(n),r=o(8),i=o.n(r),c=o(9),s=o(5),l=o(2),p=o(10),d=o.n(p),u=o(11),m=o.n(u),h=o(7),b=o.n(h),f=(o(21),o(1)),v=864e5,g=86399999,w={default:"#505558",gray:"#6b6f71",brown:"#695c55",orange:"#917448",yellow:"#9f904d",green:"#487871",blue:"#497088",purple:"#6d5a90",pink:"#924d75",red:"#a05d59"};function j(e){return(e.properties.Scope.multi_select||e.properties.Scope.select)&&e.properties.Event.title&&e.properties.Event.title[0]&&e.properties.Event.title[0].text&&e.properties.Date.date&&(!e.properties.Ongoing||e.properties.Ongoing.checkbox)&&(!e.properties.Group||e.properties.Group.select)}function O(){var e=Object(n.useState)([]),t=Object(l.a)(e,2),o=t[0],a=t[1],r=Object(n.useState)(!1),i=Object(l.a)(r,2),p=i[0],u=i[1],h=new URLSearchParams(window.location.search),O=h.get("database_id")||"",y=h.get("token")||"",x=Object(n.useState)([800,300]),D=Object(l.a)(x,2),S=Object(l.a)(D[0],2),k=S[0],M=S[1],_=D[1];Object(n.useEffect)((function(){var e=function(){_([window.innerWidth,window.innerHeight])};return e(),window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]),Object(n.useEffect)((function(){O&&y&&fetch("".concat("https://vr-cors-everywhere.herokuapp.com","/https://api.notion.com/v1/databases/").concat(O,"/query"),{method:"POST",headers:{Authorization:"Bearer ".concat(y),"Notion-Version":"2021-08-16"}}).then((function(e){return e.json()})).then((function(e){e.results&&e.results.some(j)?a(e.results):u(!0)}))}),[O,y]);var E=Object(n.useMemo)((function(){return o.map((function(e){if(!j(e))return console.log("Invalid database item:",JSON.stringify(e,null,2)),[];var t=e.properties.Event.title[0].text.content,o=e.properties.Scope.multi_select?e.properties.Scope.multi_select.map((function(e){return{name:e.name,color:e.color}})):[{name:e.properties.Scope.select.name,color:e.properties.Scope.select.color}];return o.map((function(n){var a,r,i,c,s,l;return{scope:n,scopes:o,name:t,startDate:e.properties.Date.date.start,endDate:e.properties.Date.date.end,ongoing:null!==(a=null===(r=e.properties.Ongoing)||void 0===r?void 0:r.checkbox)&&void 0!==a&&a,group:{name:null!==(i=null===(c=e.properties.Group)||void 0===c?void 0:c.select.name)&&void 0!==i?i:n.name,color:null!==(s=null===(l=e.properties.Group)||void 0===l?void 0:l.select.color)&&void 0!==s?s:n.color}}}))})).flat()}),[o]),I=Object(n.useMemo)((function(){var e,t=new Map,o=Object(s.a)(new Set(E.map((function(e){return e.group.name})))),n=Object(c.a)(o);try{var a=function(){var o=e.value,n=E.filter((function(e){return e.group.name===o}));t.set(n[0].group,n)};for(n.s();!(e=n.n()).done;)a()}catch(r){n.e(r)}finally{n.f()}return t}),[E]),z=Object(n.useMemo)((function(){return Object(s.a)(I.entries()).map((function(e){var t=Object(l.a)(e,2),o=t[0],n=t[1];return{events:n,name:o.name,color:b()(w[o.color]).lightenByRatio(.5).saturateByRatio(2).toCSS(),data:n.map((function(e){return{event:e,fillColor:w[e.group.color],strokeColor:b()(w[e.group.color]).lightenByRatio(.5).toCSS(),x:e.scope.name,y:[Date.parse(e.startDate),e.ongoing?Date.now()+g:e.endDate?Date.parse(e.endDate)+g:Date.parse(e.startDate)+g]}}))}}))}),[I]),C=Object(n.useMemo)((function(){return[Math.min.apply(Math,Object(s.a)(z.map((function(e){return e.data[0].y[0]}))))||Date.now(),Math.max.apply(Math,Object(s.a)(z.map((function(e){return e.data[0].y[1]}))))||Date.now()]}),[z]),F=Object(l.a)(C,2),B=F[0],R=F[1],L=Math.max((R-B)/100,7*v);return O&&y?p?Object(f.jsx)("div",{children:"The database is not supported by this widget"}):Object(f.jsx)(f.Fragment,{children:Object(f.jsx)(d.a,{className:"chart",type:"rangeBar",width:k-40,height:M-40,options:{chart:{toolbar:{tools:{download:!1,selection:!0,zoom:!0,zoomin:!0,zoomout:!0,pan:!0,customIcons:[{icon:'<img src="'.concat("/notion-timeline-widget",'/reload.svg" width="16">'),class:"custom-icon",index:0,title:"Reload",click:function(){return window.location.reload()}},{icon:'<img src="'.concat("/notion-timeline-widget",'/copy.svg" width="16">'),class:"custom-icon",index:0,title:"Copy URL",click:function(){return m()(window.location.href)}}]}}},plotOptions:{bar:{horizontal:!0}},dataLabels:{enabled:!0,formatter:function(e,t){var o=t.seriesIndex,n=t.dataPointIndex,a=z[o].data[n].event,r=z[o].data[n].y||[],i=Object(l.a)(r,2),c=i[0],s=i[1],p=Math.ceil((s-c)/v),d=" ("+p+(p>1?" days":" day")+")";return a.name+(a.endDate?d:"")}},theme:{palette:"palette1",mode:"dark"},xaxis:{type:"datetime",min:B-L,max:R+L},legend:{show:!0,labels:{useSeriesColors:!0}},stroke:{width:2},tooltip:{custom:function(e){var t=e.seriesIndex,o=e.dataPointIndex,n=z[t].data[o].event,a=z[t].data[o].y||[],r=Object(l.a)(a,2),i=r[0],c=r[1],s=Math.ceil((c-i)/v),p=" ("+s+(s>1?" days":" day")+")";return'<div class="chart__tooltip">\n              <p class="chart__tooltip-primary-text">'.concat(n.group.name,": ").concat(n.name).concat(n.endDate?p:"",'</p>\n              <p class="chart__tooltip-secondary-text">').concat(n.startDate).concat(n.endDate?" - ".concat(n.endDate):"","</p>\n            </div>")}},grid:{show:!0,borderColor:"#FFFFFF22",xaxis:{lines:{show:!0}},yaxis:{lines:{show:!0}}}},series:z})}):Object(f.jsx)("div",{children:"Database ID and/or Notion token is not provided"})}i.a.render(Object(f.jsx)(a.a.StrictMode,{children:Object(f.jsx)(O,{})}),document.getElementById("root"))}},[[23,1,2]]]);
//# sourceMappingURL=main.266b6f45.chunk.js.map